library(ggplot2)
library(ggthemes)
library(gtools)
library("RColorBrewer")
save_figures_flag=TRUE


### ROC curve models

#Bibeta function
FuncBibeta<-function(x, aG, bG, aB, bB){pbeta(qbeta(x,aG,bG),aB,bB)}

#Simplified bibeta function
FuncSBibeta<-function(x, aG, bB){1-(1-x^(1/aG))^bB}

#Bigamma function
FuncBigamma<-function(x, a1, b1, a2, b2){pgamma(qgamma(x,a1,b1),a2,b2)}

#Reformulated binormal function
FuncBinormal<-function(x,b,gamm){pnorm(qnorm((gamm+1)/2)*sqrt(1+b^2)+b*qnorm(x))}

#Bilogistic function
FuncBilogistic<-function(x, a0, a1){1/(1+exp(a1*log(1/x-1)-a0))}

#Power function
FuncPower<-function(x,g){x^((1-g)/(1+g))}

#Bifractal function
FuncBifractal <- function(x,beta,gamm){ (1-beta)*x^((1-gamm)/(1+gamm))+beta*(1-(1-x)^((1+gamm)/(1-gamm)))}

#Midfractal function
FuncMidfractal<-function(x,g){FuncBifractal(x,0.5,g)}

#Midnormal function
FuncMidnormal<-function(x,g){pnorm(qnorm((g+1)/2)*sqrt(2)+qnorm(x))}

#### Data

#Berg 
#https://academic.oup.com/rfs/article/33/7/2845/5568311

BergC_x<-c(0,0.014,0.028,0.044,0.067,0.084,0.11,0.13,0.148,0.174,0.208,0.236,0.262,0.282,0.303,0.321,0.349,0.372,0.392,0.416,0.443,0.469,0.512,0.556,0.591,0.644,0.694,0.745,0.808,0.861,0.895,0.942,0.97,1)
BergC_y<-c(0,0.066,0.111,0.163,0.216,0.249,0.311,0.348,0.384,0.426,0.465,0.5,0.522,0.545,0.571,0.588,0.625,0.649,0.666,0.685,0.706,0.721,0.749,0.78,0.81,0.841,0.867,0.891,0.92,0.941,0.955,0.978,0.988,1)

BergF_x<-c(0,0.016,0.029,0.053,0.084,0.103,0.166,0.251,0.288,0.326,0.367,0.447,0.502,0.588,0.651,0.735,0.844,0.9,0.936,1)
BergF_y<-c(0,0.14,0.204,0.292,0.367,0.403,0.503,0.606,0.631,0.67,0.708,0.76,0.803,0.844,0.882,0.92,0.964,0.976,0.99,1)

#Conolly, 2015, curve I
Conolly_I_x<-c(0, 0.0522522522522522, 0.106306306306306, 0.198198198198198, 0.254054054054054, 0.349549549549549, 0.463063063063063, 0.56036036036036, 0.679279279279279, 0.821621621621621, 1)
Conolly_I_y<-c(0, 0.158433734939758, 0.290361445783132, 0.456626506024096, 0.545180722891565, 0.644578313253011, 0.731325301204818, 0.828915662650601, 0.906626506024095, 0.966265060240963, 1)

#Conolly, 2015, curve II
Conolly_II_x<-c(0, 0.0612612612612612, 0.127927927927927, 0.209009009009009, 0.30990990990991, 0.401801801801802, 0.513513513513513, 0.607207207207207, 0.726126126126126, 0.855855855855856, 1)
Conolly_II_y<-c(0, 0.127710843373493, 0.277710843373493, 0.39156626506024, 0.490963855421686, 0.59578313253012, 0.689759036144577, 0.767469879518071, 0.859638554216866, 0.93012048192771, 1)

#Jennings, 2017
Jennings_x<-c(0, 0.0518404907975459, 0.101533742331288, 0.152147239263803, 0.199999999999999, 0.251533742331288, 0.303987730061349, 0.351840490797546, 0.399693251533742, 0.453987730061349, 0.502760736196319, 0.554294478527607, 0.599386503067484, 0.650920245398773, 0.709815950920245, 0.75122699386503, 0.805521472392638, 0.851533742331288, 0.902147239263803, 0.949079754601227, 1)
Jennings_y<-c(0, 0.257337883959044, 0.390443686006826, 0.490784982935153, 0.570648464163822, 0.642320819112628, 0.699658703071672, 0.746757679180887, 0.787713310580204, 0.82457337883959, 0.855290102389078, 0.879863481228669, 0.900341296928328, 0.920819112627986, 0.941296928327645, 0.951535836177474, 0.967918088737201, 0.978156996587031, 0.98839590443686, 0.994539249146758, 1)

#Hahm & Lee
HahmA_x<-c(0, 0, 0, 0.001, 0.003, 0.007, 0.014, 0.031, 0.074, 0.135, 0.257, 0.648, 0.918, 0.997, 1)
HahmA_y<-c(0, 0.003, 0.016, 0.049, 0.097, 0.178, 0.291, 0.414, 0.576, 0.689, 0.790, 0.945, 0.993, 1, 1)

HahmB_x<-c(0, 0, 0, 0, 0, 0.002, 0.0067, 0.015, 0.035, 0.073, 0.138, 0.268, 0.528, 0.735, 0.953, 0.997, 1)
HahmB_y<-c(0, 0, 0.001, 0.009, 0.036, 0.092, 0.184, 0.305, 0.438, 0.584, 0.720, 0.845, 0.947, 0.983, 0.998, 1, 1)

#Iyer https://www.nber.org/system/files/working_papers/w15242/w15242.pdf
Iyer_x<-c(0,0.013,0.045,0.079,0.115,0.188,0.255,0.309,0.353,0.404,0.44,0.479,0.518,0.565,0.622,0.672,0.728,0.779,0.828,0.878,0.934,1)
Iyer_y<-c(0,0.079,0.191,0.303,0.398,0.528,0.618,0.685,0.721,0.769,0.807,0.829,0.856,0.89,0.917,0.933,0.955,0.971,0.982,0.991,0.996,1)


# Řezáč & Řezáč, 2011
Rezac_x<-c(0, 0.0787195044874226, 0.168284666919479, 0.265630135254709, 0.365845025913285, 0.466198963468588, 0.569681456200227, 0.674668183541904, 0.781885981544685, 0.890766021994691, 1) 
Rezac_y<-c(0, 0.280469503698146, 0.468967735019831, 0.588969878872334, 0.689677350198306, 0.786686675956694, 0.857165826991103, 0.914889055632972, 0.953639189623754, 0.978347089720227, 1) 

RezacB_x<-c(0, 0.00468032, 0.00963357, 0.0270328, 0.0444337, 0.0626033, 0.0856843, 0.103838, 0.133772, 0.164513, 0.206242, 0.239203, 0.29389, 0.321474, 0.362724, 0.404795, 0.452942, 0.505316, 0.556843, 0.607544, 0.662868, 0.724255, 0.786363, 0.852627, 0.923084, 0.99047, 1) 
RezacB_y<-c(0, 0.0217549, 0.0947614, 0.147811, 0.201159, 0.255997, 0.30458, 0.356439, 0.406218, 0.464639, 0.515022, 0.561823, 0.616981, 0.653946, 0.685854, 0.729085, 0.770234, 0.819729, 0.852835, 0.873723, 0.905639, 0.933388, 0.953389, 0.968327, 0.984757, 0.996121, 1) 

#Wojcicki & Migut
Wojcicki_x<-c(0, 0.00180075, 0.0103416, 0.0236013, 0.0394678, 0.0582724, 0.0862182, 0.125754, 0.159735, 0.200729, 0.256747, 0.303452, 0.35555, 0.413357, 0.464957, 0.514596, 0.565211, 0.618765, 0.674278, 0.729626, 0.788731, 0.847508, 0.914449, 1) 
Wojcicki_y<-c(0, 0.0148117, 0.171101, 0.279015, 0.370014, 0.45917, 0.543327, 0.620904, 0.68974, 0.732154, 0.7873, 0.82259, 0.871643, 0.905376, 0.931954, 0.950065, 0.959189, 0.968056, 0.976135, 0.979454, 0.988072, 0.992458, 0.999774, 1) 

#Tobback & Martens, 2017
Tobback_x<-c(0, 0.00853731343283581, 0.0108412483039348, 0.0175902306648574, 0.0265210312075983, 0.0398398914518317, 0.0574979647218452, 0.0883364993215739, 0.119109905020352, 0.145438263229308, 0.180559023066485, 0.211299864314789, 0.250719131614654, 0.294518317503392, 0.34488738127544, 0.353728629579376, 0.38216553595658, 0.410602442333785, 0.432477611940298, 0.460922659430122, 0.487137042062415, 0.526442333785617, 0.567921302578019, 0.618111261872456, 0.668301221166892, 0.718491180461329, 0.779590230664857, 0.840689280868385, 0.888705563093622, 1)
Tobback_y<-c(0, 0.148507462686567, 0.182089552238805, 0.238059701492537, 0.294029850746268, 0.356716417910447, 0.412686567164179, 0.493283582089552, 0.555970149253731, 0.596268656716418, 0.654477611940298, 0.70820895522388, 0.748507462686567, 0.793283582089552, 0.844776119402985, 0.876119402985074, 0.896268656716418, 0.916417910447761, 0.932089552238806, 0.954477611940298, 0.963432835820895, 0.972388059701492, 0.97910447761194, 0.98134328358209, 0.983582089552239, 0.985820895522388, 0.988059701492537, 0.990298507462687, 0.994776119402985, 1)

#ModelA1
A1_x<-c(0, 0.000679655641141822, 0.000906207521522429, 0.00113275940190304, 0.00135931128228364, 0.00158586316266425, 0.00226551880380607, 0.00249207068418668, 0.0031717263253285, 0.00453103760761214, 0.00498414136837336, 0.00657000453103761, 0.0106479383778885, 0.0122338015405528, 0.0133665609424558, 0.0169913910285455, 0.0185772541912098, 0.0217489805165383, 0.0235613955595831, 0.0258269143633892, 0.0287720888083371, 0.0376076121431808, 0.0453103760761214, 0.0541458994109651, 0.0632079746261894, 0.0770276393294064, 0.0874490258269144, 0.100362483008609, 0.113502492070684, 0.123923878568192, 0.133439057544178, 0.148164929768917, 0.161984594472134, 0.177616674218396, 0.185319438151337, 0.201857725419121, 0.218396012686905, 0.234707748074309, 0.246714997734481, 0.267104666968736, 0.285228817399184, 0.299048482102401, 0.318078840054372, 0.327820570910739, 0.353194381513367, 0.370865428183054, 0.391481649297689, 0.407793384685093, 0.427956502038967, 0.449705482555505, 0.475758948799275, 0.495015858631627, 0.513140009062075, 0.539193475305845, 0.557544177616674, 0.580199365654735, 0.599909379247848, 0.616447666515632, 0.637063887630267, 0.655867693701858, 0.676030811055732, 0.697100135931128, 0.719755323969189, 0.734254644313548, 0.751699139102855, 0.766651563207975, 0.78726778432261, 0.801540552786588, 0.814680561848663, 0.832351608518351, 0.845491617580426, 0.860444041685546, 0.870185772541912, 0.884685092886271, 0.899864068871772, 0.913230629814227, 0.920027186225646, 0.927729950158586, 0.937698232895333, 0.943815133665609, 0.951064793837789, 0.954916175804259, 0.960806524694155, 0.968056184866334, 0.97009515178976, 0.971907566832805, 0.977344811961939, 0.981649297689171, 0.98504757589488, 0.987539646579067, 0.989805165382873, 0.992750339827821, 0.993429995468962, 0.993883099229724, 0.995922066153149, 0.997734481196194, 0.998867240598097, 0.999093792478478, 0.999546896239239, 0.999773448119619, 1)
A1_y<-c(0, 0.00173310225303293, 0.00346620450606586, 0.00346620450606586, 0.00693240901213172, 0.0103986135181976, 0.0138648180242634, 0.0138648180242634, 0.0155979202772964, 0.0173310225303293, 0.0173310225303293, 0.0207972270363951, 0.0294627383015598, 0.0363951473136915, 0.0415944540727903, 0.0502599653379549, 0.0571923743500867, 0.0658578856152513, 0.0779896013864818, 0.0797227036395147, 0.0866551126516465, 0.109185441941075, 0.117850953206239, 0.135181975736568, 0.150779896013865, 0.188908145580589, 0.209705372616984, 0.235701906412478, 0.253032928942808, 0.261698440207972, 0.277296360485269, 0.305025996533795, 0.325823223570191, 0.357019064124783, 0.370883882149047, 0.391681109185442, 0.412478336221837, 0.431542461005199, 0.45580589254766, 0.480069324090121, 0.493934142114385, 0.509532062391681, 0.525129982668977, 0.540727902946274, 0.570190641247834, 0.582322357019064, 0.61525129982669, 0.632582322357019, 0.660311958405546, 0.670710571923744, 0.681109185441941, 0.701906412478336, 0.7157712305026, 0.741767764298094, 0.755632582322357, 0.778162911611785, 0.793760831889081, 0.805892547660312, 0.82842287694974, 0.844020797227036, 0.849220103986135, 0.866551126516464, 0.871750433275563, 0.878682842287695, 0.892547660311958, 0.89948006932409, 0.916811091854419, 0.923743500866551, 0.935875216637782, 0.937608318890815, 0.939341421143847, 0.948006932409012, 0.953206239168111, 0.963604852686308, 0.963604852686308, 0.965337954939341, 0.965337954939341, 0.97053726169844, 0.974003466204506, 0.977469670710572, 0.980935875216638, 0.986135181975737, 0.989601386481802, 0.989601386481802, 0.989601386481802, 0.991334488734835, 0.994800693240901, 0.994800693240901, 0.994800693240901, 0.994800693240901, 0.996533795493934, 0.996533795493934, 0.996533795493934, 0.996533795493934, 0.996533795493934, 0.998266897746967, 0.998266897746967, 1, 1, 1, 1)

#ModelA2
A2_y<-c(0, 0.0015017833677492, 0.00168950628871785, 0.00206495213065515, 0.00281584381452975, 0.0030035667354984, 0.00319128965646705, 0.0033790125774357, 0.00412990426131031, 0.00431762718227896, 0.00450535010324761, 0.00525624178712221, 0.00544396470809086, 0.00563168762905951, 0.00694574807584006, 0.00713347099680871, 0.00750891683874601, 0.00807208560165196, 0.00825980852262061, 0.00863525436455791, 0.00938614604843251, 0.00994931481133846, 0.0108879294161817, 0.0116388211000563, 0.011826544021025, 0.0135160503097428, 0.0152055565984607, 0.0161441712033039, 0.0168950628871785, 0.0176459545710531, 0.0182091233339591, 0.019335460859771, 0.0197109067017083, 0.0200863525436456, 0.0208372442275202, 0.0210249671484888, 0.0229021963581753, 0.0232776422001126, 0.0244039797259245, 0.0255303172517364, 0.0264689318565797, 0.0272198235404543, 0.0274075464614229, 0.0289093298291721, 0.0298479444340154, 0.0309742819598273, 0.0326637882485451, 0.0339778486953257, 0.0352919091421063, 0.0360428008259809, 0.038107752956636, 0.0399849821663225, 0.0405481509292285, 0.0428008259808523, 0.0435517176647269, 0.0465552844002253, 0.0471184531631312, 0.049371128214755, 0.0504974657405669, 0.0523746949502534, 0.0540642012389713, 0.0555659846067205, 0.0583818284212502, 0.0600713347099681, 0.0613853951567486, 0.0638257931293411, 0.064952130655153, 0.06814342031162, 0.0711469870471185, 0.0745259996245542, 0.0769663975971466, 0.0790313497278018, 0.0820349164633002, 0.0833489769100807, 0.0859770978036418, 0.0886052186972029, 0.0914210625117327, 0.0938614604843251, 0.0976159189036981, 0.101182654402103, 0.105875727426319, 0.107752956636005, 0.110944246292472, 0.113947813027971, 0.117702271447344, 0.120330392340905, 0.123897127839309, 0.126712971653839, 0.129528815468369, 0.134409611413554, 
        0.137600901070021, 0.141167636568425, 0.143983480382955, 0.148113384644265, 0.153181903510419, 0.15712408485076, 0.160503097428196, 0.16275577247982, 0.16688567674113, 0.170452412239534, 0.173268256054064, 0.176084099868594, 0.179087666604092, 0.181528064576685, 0.185470245917026, 0.190351041862211, 0.195607283649334, 0.199924910831613, 0.204993429697766, 0.209123333959076, 0.213816406983293, 0.219823540454289, 0.224892059320443, 0.229209686502722, 0.23502909705275, 0.240097615918904, 0.246855641073775, 0.253050497465741, 0.260371691383518, 0.266941993617421, 0.272385958325512, 0.279894875164258, 0.283086164820725, 0.286652900319129, 0.291158250422377, 0.29622676928853, 0.30035667354984, 0.304298854890182, 0.309555096677304, 0.313685000938615, 0.320630749014455, 0.325699267880608, 0.331143232588699, 0.33790125774357, 0.343157499530693, 0.349164633001689, 0.353482260183968, 0.361178899943683, 0.365684250046931, 0.37131593767599, 0.375633564858269, 0.379388023277642, 0.384831987985733, 0.391214567298667, 0.396470809085789, 0.402853388398723, 0.409611413553595, 0.414867655340717, 0.421250234653651, 0.428195982729491, 0.434015393279519, 0.441712033039234, 0.447719166510231, 0.452412239534447, 0.458794818847381, 0.463300168950629, 0.467993241974845, 0.475126712971654, 0.481509292284588, 0.489769100807209, 0.49371128214755, 0.501783367749202, 0.506100994931481, 0.513985357612164, 0.519992491083161, 0.525811901633189, 0.532006758025155, 0.535385770602591, 0.541392904073587, 0.54664914586071, 0.552656279331706, 0.559789750328515, 0.5646705462737, 0.574619861085038, 0.580063825793129, 0.588699080157687, 0.594330767786747, 0.600713347099681, 0.608785432701333, 0.61329078280458, 0.619297916275577, 0.621550591327201, 0.629247231086916, 0.635442087478881, 0.639571991740192, 0.64952130655153, 0.654402102496715, 0.661160127651586, 0.667167261122583, 0.672986671672611, 0.679744696827483, 
        0.685376384456542, 0.693073024216257, 0.698329266003379, 0.706589074526, 0.711469870471184, 0.718040172705087, 0.722545522808335, 0.726487704148677, 0.736061573118078, 0.740379200300357, 0.74544771916651, 0.75239346724235, 0.758212877792378, 0.76628496339403, 0.772667542706964, 0.779050122019899, 0.783555472123146, 0.788436268068331, 0.79556973906514, 0.798573305800638, 0.804955885113572, 0.807584006007133, 0.81359113947813, 0.818659658344284, 0.822601839684626, 0.824854514736249, 0.829359864839497, 0.835742444152431, 0.837995119204055, 0.842500469307302, 0.846818096489581, 0.850760277829923, 0.855077905012202, 0.857330580063826, 0.862586821850948, 0.865590388586446, 0.869720292847757, 0.874225642951004, 0.878355547212315, 0.884925849446217, 0.888868030786559, 0.892997935047869, 0.896752393467242, 0.902196358175333, 0.904261310305988, 0.905763093673738, 0.907828045804393, 0.909705275014079, 0.913459733433452, 0.915900131406045, 0.917589637694763, 0.919654589825418, 0.923033602402853, 0.927538952506101, 0.932419748451286, 0.935047869344847, 0.938051436080345, 0.940116388211001, 0.942744509104562, 0.945372629998123, 0.949127088417496, 0.950253425943308, 0.951567486390088, 0.951942932232026, 0.952130655152994, 0.953444715599775, 0.954195607283649, 0.954758776046555, 0.956260559414304, 0.957574619861085, 0.958888680307866, 0.960015017833677, 0.961141355359489, 0.962079969964333, 0.96245541580627, 0.963206307490145, 0.963394030411113, 0.963769476253051, 0.965458982541768, 0.966022151304674, 0.967336211751455, 0.968274826356298, 0.969588886803079, 0.970339778486953, 0.971090670170828, 0.971841561854702, 0.972404730617608, 0.97353106814342, 0.974094236906326, 0.974845128590201, 0.976159189036981, 0.976722357799887, 0.977285526562793, 0.977660972404731, 0.978036418246668, 0.978224141167637, 0.978787309930543, 0.978975032851511, 0.97916275577248, 0.98047681621926, 0.980664539140229, 
        0.981603153745072, 0.982166322507978, 0.982166322507978, 0.982917214191853, 0.983104937112821, 0.984231274638633, 0.984418997559602, 0.985545335085414, 0.985920780927351, 0.986671672611226, 0.987610287216069, 0.987985733058006, 0.988173455978975, 0.988736624741881, 0.989299793504787, 0.989675239346724, 0.989862962267693, 0.989862962267693, 0.990613853951568, 0.990801576872536, 0.991177022714473, 0.991364745635442, 0.991552468556411, 0.991740191477379, 0.991927914398348, 0.992491083161254, 0.99305425192416, 0.993617420687066, 0.993992866529003, 0.994180589449972, 0.99436831237094, 0.994743758212878, 0.994931481133846, 0.995682372817721, 0.995682372817721, 0.99587009573869, 0.996433264501596, 0.996433264501596, 0.996620987422564, 0.996808710343533, 0.996996433264502, 0.99718415618547, 0.997371879106439, 0.997559602027408, 1)
A2_x<-c(0, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00141843971631206, 0.00283687943262411, 0.00283687943262411, 0.00283687943262411, 0.00283687943262411, 0.00283687943262411, 0.00283687943262411, 0.00283687943262411, 0.00283687943262411, 0.00283687943262411, 0.00425531914893617, 0.00567375886524823, 0.00567375886524823, 0.00567375886524823, 0.00709219858156028,         0.00709219858156028, 0.00709219858156028, 0.00709219858156028, 0.00709219858156028, 0.00709219858156028, 0.0113475177304965, 0.0113475177304965, 0.0113475177304965, 0.0141843971631206, 0.0141843971631206, 0.0156028368794326, 0.0184397163120567, 0.0198581560283688, 0.0198581560283688, 0.0198581560283688, 0.0198581560283688, 0.0198581560283688, 0.0198581560283688, 0.0198581560283688, 0.0198581560283688, 0.0212765957446809, 0.0226950354609929, 0.0226950354609929, 0.0226950354609929, 0.024113475177305, 0.024113475177305, 0.024113475177305, 0.025531914893617, 0.0269503546099291, 0.0283687943262411, 0.0283687943262411, 0.0283687943262411, 0.0297872340425532, 0.0297872340425532, 0.0312056737588652, 0.0312056737588652, 0.0326241134751773, 0.0354609929078014, 0.0368794326241135, 0.0411347517730496, 0.0411347517730496, 0.0425531914893617, 
        0.0468085106382979, 0.0468085106382979, 0.0468085106382979, 0.049645390070922, 0.0524822695035461, 0.0553191489361702, 0.0553191489361702, 0.0581560283687943, 0.0609929078014184, 0.0609929078014184, 0.0624113475177305, 0.0652482269503546, 0.0652482269503546, 0.0652482269503546, 0.0652482269503546, 0.0709219858156028, 0.0723404255319149, 0.0765957446808511, 0.0794326241134752, 0.0808510638297872, 0.0822695035460993, 0.0865248226950355, 0.0879432624113475, 0.0893617021276596, 0.0950354609929078, 0.0950354609929078, 0.0978723404255319, 0.100709219858156, 0.104964539007092, 0.109219858156028, 0.109219858156028, 0.11063829787234, 0.11063829787234, 0.114893617021277, 0.119148936170213, 0.121985815602837, 0.121985815602837, 0.127659574468085, 0.134751773049645, 0.13758865248227, 0.140425531914894, 0.141843971631206, 0.15177304964539, 0.15177304964539, 0.154609929078014, 0.160283687943262, 0.163120567375887, 0.164539007092199, 0.168794326241135, 0.173049645390071, 0.175886524822695, 0.178723404255319, 0.185815602836879, 0.191489361702128, 0.197163120567376, 0.204255319148936, 0.205673758865248, 0.211347517730496, 0.215602836879433, 0.218439716312057, 0.228368794326241, 0.236879432624113, 0.242553191489362, 0.249645390070922, 0.25531914893617, 0.259574468085106, 0.263829787234043, 0.269503546099291, 0.275177304964539, 0.280851063829787, 0.282269503546099, 0.286524822695035, 0.292198581560284, 0.299290780141844, 0.300709219858156, 0.302127659574468, 0.312056737588652, 0.319148936170213, 0.321985815602837, 0.330496453900709, 0.333333333333333, 0.334751773049645, 0.336170212765957, 0.339007092198582, 0.347517730496454, 0.353191489361702, 0.361702127659574, 0.365957446808511, 0.368794326241135, 0.373049645390071, 0.375886524822695, 0.385815602836879, 0.391489361702128, 0.401418439716312, 0.40709219858156, 0.417021276595745, 0.425531914893617, 0.439716312056738, 0.443971631205674, 
        0.446808510638298, 0.452482269503546, 0.466666666666667, 0.476595744680851, 0.485106382978723, 0.486524822695035, 0.493617021276596, 0.495035460992908, 0.509219858156028, 0.516312056737589, 0.519148936170213, 0.526241134751773, 0.531914893617021, 0.54468085106383, 0.554609929078014, 0.560283687943262, 0.564539007092199, 0.575886524822695, 0.577304964539007, 0.580141843971631, 0.588652482269504, 0.597163120567376, 0.602836879432624, 0.612765957446809, 0.621276595744681, 0.632624113475177, 0.638297872340426, 0.642553191489362, 0.651063829787234, 0.660992907801418, 0.670921985815603, 0.678014184397163, 0.683687943262411, 0.692198581560284, 0.709219858156028, 0.714893617021277, 0.723404255319149, 0.726241134751773, 0.730496453900709, 0.740425531914894, 0.746099290780142, 0.750354609929078, 0.753191489361702, 0.761702127659574, 0.771631205673759, 0.777304964539007, 0.780141843971631, 0.782978723404255, 0.785815602836879, 0.79290780141844, 0.797163120567376, 0.80709219858156, 0.814184397163121, 0.818439716312057, 0.834042553191489, 0.835460992907801, 0.84113475177305, 0.845390070921986, 0.851063829787234, 0.859574468085106, 0.870921985815603, 0.872340425531915, 0.872340425531915, 0.873758865248227, 0.876595744680851, 0.880851063829787, 0.882269503546099, 0.883687943262411, 0.890780141843972, 0.890780141843972, 0.89645390070922, 0.897872340425532, 0.899290780141844, 0.900709219858156, 0.900709219858156, 0.900709219858156, 0.906382978723404, 0.91063829787234, 0.912056737588652, 0.913475177304965, 0.914893617021277, 0.916312056737589, 0.916312056737589, 0.920567375886525, 0.923404255319149, 0.924822695035461, 0.924822695035461, 0.933333333333333, 0.933333333333333, 0.933333333333333, 0.934751773049645, 0.934751773049645, 0.936170212765957, 0.936170212765957, 0.941843971631206, 0.941843971631206, 0.943262411347518, 0.946099290780142, 0.946099290780142, 0.948936170212766, 
        0.948936170212766, 0.950354609929078, 0.950354609929078, 0.953191489361702, 0.956028368794326, 0.956028368794326, 0.956028368794326, 0.956028368794326, 0.956028368794326, 0.957446808510638, 0.95886524822695, 0.964539007092199, 0.967375886524823, 0.970212765957447, 0.971631205673759, 0.971631205673759, 0.971631205673759, 0.973049645390071, 0.974468085106383, 0.974468085106383, 0.978723404255319, 0.978723404255319, 0.978723404255319, 0.981560283687943, 0.981560283687943, 0.982978723404255, 0.982978723404255, 0.984397163120567, 0.985815602836879, 0.985815602836879, 0.987234042553191, 0.987234042553191, 0.987234042553191, 0.987234042553191, 0.988652482269504, 0.990070921985816, 0.991489361702128, 0.99290780141844, 0.994326241134752, 0.995744680851064, 0.995744680851064, 0.998581560283688, 0.998581560283688, 0.998581560283688, 0.998581560283688, 1)

#ModelB1
B1_x<-c(0, 0.00199236260999502, 0.00249045326249377, 0.00282251369749294, 0.00315457413249211, 
        0.00365266478499087, 0.00398472521999004, 0.00415075543748962, 0.00464884608998838, 
        0.00514693674248713, 0.00630914826498423, 0.00680723891748298, 0.00713929935248215, 
        0.00730532956998174, 0.00813548065747966, 0.00929769217997676, 0.0102938734849743, 
        0.0112900547899718, 0.0129503569649676, 0.0149427195749626, 0.0159389008799602, 
        0.0169350821849577, 0.0177652332724556, 0.0189274447949527, 0.0192595052299519, 
        0.0207537771874481, 0.0222480491449444, 0.0288892578449278, 0.0313797111074215, 
        0.0320438319774199, 0.0347003154574132, 0.0355304665449112, 0.0365266478499087, 
        0.0380209198074049, 0.039183131329902, 0.0421716752448946, 0.0438319774198904, 
        0.0448281587248879, 0.0456583098123859, 0.0473186119873817, 0.0484808235098788, 
        0.050805246554873, 0.0537937904698655, 0.054789971774863, 0.0564502739498589, 
        0.0577785156898556, 0.0597708782998506, 0.0610991200398473, 0.0622613315623443, 
        0.0639216337373402, 0.0667441474348331, 0.0698987215673253, 0.0722231446123194, 
        0.0737174165698157, 0.0755437489623111, 0.0775361115723062, 0.0881620454922796, 
        0.0909845591897725, 0.0926448613647684, 0.0946372239747634, 0.105595218329736, 
        0.114062759422215, 0.115224970944712, 0.118213514859704, 0.121368088992197, 
        0.12419060268969, 0.12784326747468, 0.130499750954674, 0.132658143782168, 0.134318445957164, 
        0.140959654657148, 0.143616138137141, 0.146604682052133, 0.149427195749626, 0.154740162709613, 
        0.157894736842105, 0.162377552714594, 0.167690519674581, 0.171177154242072, 0.175161879462062, 
        0.18811223642703, 0.19591565664951, 0.200730532956998, 0.209198074049477, 0.213348829486967, 
        0.216835464054458, 0.230449941889424, 0.234102606674415, 0.25585256516686, 0.264486136476839, 
        0.269467043001826, 0.275610161049311, 0.285738004316786, 0.302507056284244, 0.306823841939233, 
        0.312800929769218, 0.317781836294206, 0.322264652166694, 0.326581437821684, 0.336543250871659, 
        0.341856217831645, 0.347667275444131, 0.357297028059107, 0.364768387846588, 0.374896231114063, 
        0.380873318944048, 0.384692013946538, 0.391333222646522, 0.399468703304001, 0.407272123526482, 
        0.413415241573966, 0.417898057446455, 0.423044994188942, 0.42785987049643, 0.432674746803918, 
        0.439315955503902, 0.445293043333887, 0.465548729868836, 0.470529636393824, 0.476506724223809, 
        0.481985721401295, 0.488792960318778, 0.494604017931264, 0.516686036858708, 0.537771874481156, 
        0.543416901876141, 0.548895899053628, 0.566495102108584, 0.572970280591068, 0.578117217333555, 
        0.588411090818529, 0.609995019093475, 0.61613813714096, 0.632741158890918, 0.64403121368089, 
        0.64818196911838, 0.68819525153578, 0.697825004150755, 0.760750456583098, 0.764901212020588, 
        0.798771376390503, 0.81205379379047, 0.81587248879296, 0.823509878797941, 0.881786485140296, 
        0.906691017765233, 0.993192761082517, 1)
B1_y<-c(0, 0.0285714285714286, 0.0357142857142857, 0.0428571428571429, 0.0571428571428571, 
        0.0642857142857143, 0.0678571428571429, 0.0714285714285714, 0.0785714285714286, 
        0.0821428571428571, 0.0928571428571429, 0.0964285714285714, 0.1, 0.114285714285714, 
        0.132142857142857, 0.135714285714286, 0.139285714285714, 0.146428571428571, 0.153571428571429,
        0.164285714285714, 0.167857142857143, 0.171428571428571, 0.178571428571429, 0.189285714285714, 
        0.196428571428571, 0.203571428571429, 0.210714285714286, 0.214285714285714, 0.225, 
        0.228571428571429, 0.239285714285714, 0.242857142857143, 0.25, 0.257142857142857, 
        0.260714285714286, 0.264285714285714, 0.267857142857143, 0.278571428571429, 0.282142857142857, 
        0.285714285714286, 0.3, 0.310714285714286, 0.317857142857143, 0.328571428571429, 0.339285714285714,
        0.342857142857143, 0.353571428571429, 0.367857142857143, 0.375, 0.378571428571429, 
        0.382142857142857, 0.385714285714286, 0.392857142857143, 0.396428571428571, 
        0.407142857142857, 0.417857142857143, 0.428571428571429, 0.432142857142857, 0.442857142857143, 
        0.45, 0.464285714285714, 0.475, 0.482142857142857, 0.485714285714286, 0.489285714285714, 
        0.492857142857143, 0.5, 0.507142857142857, 0.514285714285714, 0.521428571428571, 0.525, 
        0.528571428571429, 0.539285714285714, 0.542857142857143, 0.55, 0.560714285714286, 
        0.564285714285714, 0.578571428571429, 0.582142857142857, 0.6, 0.607142857142857, 
        0.617857142857143, 0.628571428571429, 0.635714285714286, 0.646428571428571, 0.660714285714286, 
        0.667857142857143, 0.671428571428571, 0.682142857142857, 0.689285714285714, 0.692857142857143, 
        0.696428571428571, 0.703571428571429, 0.714285714285714, 0.721428571428571, 0.728571428571429, 
        0.732142857142857, 0.739285714285714, 0.742857142857143, 0.75, 0.757142857142857, 
        0.760714285714286, 0.771428571428571, 0.775, 0.782142857142857, 0.789285714285714, 
        0.796428571428571, 0.8, 0.803571428571429, 0.814285714285714, 0.817857142857143, 0.825,
        0.828571428571429, 0.839285714285714, 0.842857142857143, 0.846428571428571, 0.85, 
        0.857142857142857, 0.864285714285714, 0.867857142857143, 0.871428571428571, 0.875, 
        0.882142857142857, 0.885714285714286, 0.889285714285714, 0.896428571428571, 0.9, 
        0.907142857142857, 0.910714285714286, 0.925, 0.928571428571429, 0.932142857142857, 
        0.939285714285714, 0.942857142857143, 0.946428571428571, 0.95, 0.957142857142857, 
        0.967857142857143, 0.971428571428571, 0.975, 0.978571428571429, 0.982142857142857, 
        0.985714285714286, 0.989285714285714, 0.992857142857143, 0.996428571428571, 1, 1)

#ModelB2
B2_x<-c(0, 0.00228050171037628, 0.0136830102622577, 0.0171037628278221, 0.0182440136830103, 
        0.0228050171037628, 0.0273660205245154, 0.0307867730900798, 0.0364880273660205, 
        0.0387685290763968, 0.0444697833523375, 0.0456100342075257, 0.0478905359179019, 
        0.0490307867730901, 0.0501710376282782, 0.0547320410490308, 0.0570125427594071, 
        0.0638540478905359, 0.0672748004561003, 0.0695553021664766, 0.0718358038768529, 
        0.0741163055872292, 0.0775370581527936, 0.0843785632839225, 0.0877993158494869, 
        0.100342075256556, 0.101482326111745, 0.103762827822121, 0.114025085518814, 0.118586088939567, 
        0.119726339794755, 0.120866590649943, 0.124287343215507, 0.133409350057013, 0.134549600912201, 
        0.135689851767389, 0.137970353477765, 0.151653363740023, 0.163055872291904, 0.171037628278221, 
        0.173318129988597, 0.174458380843786, 0.183580387685291, 0.19612314709236, 0.197263397947548, 
        0.199543899657925, 0.205245153933865, 0.221208665906499, 0.269099201824401, 0.313568985176739, 
        0.31927023945268, 0.326111744583808, 0.329532497149373, 0.33751425313569, 0.343215507411631, 
        0.347776510832383, 0.354618015963512, 0.371721778791334, 0.378563283922463, 0.394526795895097, 
        0.40478905359179, 0.591790193842645, 0.706955530216648, 0.769669327251995, 0.818700114025085, 
        0.868871151653364, 1)

B2_y<-c(0, 0.078125, 0.171875, 0.1953125, 0.2109375, 0.2421875, 0.25, 0.265625, 0.2734375, 0.296875, 
        0.3125, 0.3203125, 0.3359375, 0.3671875, 0.390625, 0.40625, 0.421875, 0.4296875, 0.4375, 
        0.4609375, 0.4765625, 0.484375, 0.4921875, 0.515625, 0.5234375, 0.5390625, 0.546875, 
        0.5546875, 0.578125, 0.59375, 0.6015625, 0.609375, 0.6171875, 0.65625, 0.6640625, 0.671875, 
        0.6953125, 0.7265625, 0.7421875, 0.75, 0.7578125, 0.765625, 0.7734375, 0.796875, 0.8046875, 
        0.8125, 0.8203125, 0.828125, 0.84375, 0.8515625, 0.859375, 0.8671875, 0.875, 0.8828125, 
        0.890625, 0.8984375, 0.90625, 0.9140625, 0.921875, 0.9375, 0.953125, 0.96875, 0.9765625, 
        0.984375, 0.9921875, 1, 1)


#ModelB3
B3_x<-c(0, 0.00114025085518814, 0.00342075256556442, 0.015963511972634, 0.0182440136830103, 
        0.0285062713797035, 0.0330672748004561, 0.0353477765108324, 0.0364880273660205, 
        0.0456100342075257, 0.0490307867730901, 0.0524515393386545, 0.0570125427594071, 
        0.0581527936145952, 0.0604332953249715, 0.0638540478905359, 0.0695553021664766, 
        0.0718358038768529, 0.0820980615735462, 0.0855188141391106, 0.096921322690992, 
        0.118586088939567, 0.123147092360319, 0.133409350057013, 0.135689851767389, 
        0.139110604332953, 0.14139110604333, 0.143671607753706, 0.14709236031927, 0.152793614595211, 
        0.167616875712657, 0.193842645381984, 0.198403648802737, 0.204104903078677, 0.214367160775371, 
        0.233751425313569, 0.251995438996579, 0.255416191562144, 0.259977194982896, 0.269099201824401, 
        0.279361459521095, 0.285062713797035, 0.318129988597491, 0.31927023945268, 0.332953249714937, 
        0.345496009122007, 0.362599771949829, 0.369441277080958, 0.378563283922463, 0.38654503990878, 
        0.411630558722919, 0.4230330672748, 0.438996579247434, 0.446978335233751, 0.449258836944128, 
        0.456100342075257, 0.472063854047891, 0.498289623717218, 0.499429874572406, 0.514253135689852, 
        0.521094640820981, 0.55188141391106, 0.58266818700114, 0.632839224629418, 0.639680729760547, 
        0.648802736602052, 0.654503990877993, 0.671607753705815, 0.690992018244014, 0.725199543899658, 
        0.806157354618016, 0.841505131128848, 0.849486887115165, 0.890535917901938, 0.915621436716078, 1)

B3_y<-c(0, 0.03125, 0.078125, 0.171875, 0.1796875, 0.234375, 0.25, 0.265625, 0.28125, 0.3125, 
        0.328125, 0.3359375, 0.359375, 0.375, 0.3828125, 0.390625, 0.3984375, 0.4140625, 0.421875, 0.4609375, 
        0.4921875, 0.5, 0.5078125, 0.515625, 0.5234375, 0.53125, 0.5390625, 0.5546875, 0.5625, 0.5703125, 
        0.578125, 0.59375, 0.609375, 0.6171875, 0.625, 0.6328125, 0.640625, 0.6484375, 0.65625, 0.6640625, 
        0.671875, 0.6796875, 0.6953125, 0.703125, 0.7109375, 0.71875, 0.7265625, 0.734375, 0.7421875, 0.75, 
        0.7734375, 0.7890625, 0.796875, 0.8125, 0.8203125, 0.828125, 0.8359375, 0.84375, 0.859375, 0.8671875, 
        0.875, 0.890625, 0.8984375, 0.9140625, 0.921875, 0.9296875, 0.9375, 0.9453125, 0.953125, 0.9609375, 
        0.96875, 0.9765625, 0.984375, 0.9921875, 1, 1)

#ModelC1
C1_x<-c(0, 0.00117794879849223, 0.00753887231035024, 0.012721847023716, 0.0263075231663264, 0.0530862258520496, 0.0936861944400817, 0.140725616459871, 0.200565415423276, 0.276503847966075, 0.360844981938118, 0.445971415109157, 0.545625883461599, 0.645751531333438, 0.732370032982566, 0.811371132401445, 0.876550965918015, 0.92578922569499, 0.955944714936391, 0.975891314590859, 0.987984922255379, 0.996466153604523, 1)
C1_y<-c(0, 0.00507162558946525, 0.0336328854880327, 0.0581012545600142, 0.114067087819201, 0.195657976688317, 0.291751935225554, 0.386600231337308, 0.493638224041285, 0.592312483317021, 0.681911202064241, 0.75958715188184, 0.82872141649613, 0.884598273867782, 0.9249043509209, 0.954800249132485, 0.973485185514726, 0.987365423970104, 0.994483494972862, 0.9974196992615, 0.998576385799448, 0.999555120562328, 1)

#ModelD1
D1_x<-c(0, 0.029, 0.09, 0.173, 0.262, 0.349, 0.467, 0.583, 0.691, 0.838, 1)
D1_y<-c(0, 0.182, 0.328, 0.441, 0.559, 0.677, 0.754, 0.832, 0.907, 0.967, 1)


## Results vectors

names<-c()
Binormal_1<-c()
Binormal_2<-c()
Binormal_obj<-c()
Binormal_rmsp<-c()
Midnormal_1<-c()
Midnormal_obj<-c()
Midnormal_rmsp<-c()
Bifractal_1<-c()
Bifractal_2<-c()
Bifractal_obj<-c()
Bifractal_rmsp<-c()
Midfractal_1<-c()
Midfractal_obj<-c()
Midfractal_rmsp<-c()
Bilogistic_1<-c()
Bilogistic_2<-c()
Bilogistic_obj<-c()
Bilogistic_rmsp<-c()
Bibeta_1<-c()
Bibeta_2<-c()
Bibeta_3<-c()
Bibeta_4<-c()
Bibeta_obj<-c()
Bibeta_rmsp<-c()
SBibeta_1<-c()
SBibeta_2<-c()
SBibeta_obj<-c()
SBibeta_rmsp<-c()
Bigamma_1<-c()
Bigamma_2<-c()
Bigamma_3<-c()
Bigamma_4<-c()
Bigamma_obj<-c()
Bigamma_rmsp<-c()
Power_1<-c()
Power_obj<-c()
Power_rmsp<-c()



### Curve fitting macro

library(gtools)

ROC_fitting <- defmacro(input_x, input_y, input_name, expr={
  
  #Example for testing:
  #name<-'RezacRezac'
  #input_x<-Rezac_x
  #input_x<-BergC_x
  #input_y<-Rezac_y
  #input_y<-BergC_y
  
  piecewise=approxfun(input_x, input_y)
  
  fobj_Binormal<-function(pars){
    fi<-function(x){(FuncBinormal(x, pars[1], pars[2])-piecewise(x))^2}
    integrate(fi,0,1)[[1]]}
  optres_Binormal<-optim(par=c(1,.5), fn=fobj_Binormal)
  
  fobj_Midnormal<-function(pars){
    fi<-function(x){(FuncMidnormal(x, pars[1])-piecewise(x))^2}
    integrate(fi,0,1)[[1]]}
  optres_Midnormal<-optim(par=c(.5), fn=fobj_Midnormal, lower=c(0), upper=c(1), method="Brent")
  
  fobj_Bifractal<-function(pars){
    fi<-function(x){(FuncBifractal(x, pars[1], pars[2])-piecewise(x))^2}
    integrate(fi,0,1)[[1]]}
  optres_Bifractal<-optim(par=c(.5,.5), fn=fobj_Bifractal)
  
  fobj_Midfractal<-function(pars){
    fi<-function(x){(FuncMidfractal(x, pars[1])-piecewise(x))^2}
    integrate(fi,0,1)[[1]]}
  optres_Midfractal<-optim(par=c(.5), fn=fobj_Midfractal, lower=c(0), upper=c(1), method="Brent")
  
  fobj_Bilogistic<-function(pars){
    fi<-function(x){(FuncBilogistic(x, pars[1], pars[2])-piecewise(x))^2}
    integrate(fi,0,1)[[1]]}
  optres_Bilogistic<-optim(par=c(1,1), fn=fobj_Bilogistic)
  
  fobj_SBibeta<-function(pars){
    fi<-function(x){(FuncSBibeta(x, pars[1], pars[2])-piecewise(x))^2}
    integrate(fi,0,1)[[1]]}
  optres_SBibeta<-optim(par=c(1,1), fn=fobj_SBibeta)
  
  fobj_Bibeta<-function(pars){
    fi<-function(x){(FuncBibeta(x, pars[1], pars[2], pars[3], pars[4])-piecewise(x))^2}
    integrate(fi,0,1)[[1]]}
  optres_Bibeta<-optim(par=c(optres_SBibeta$par[1],1,1,optres_SBibeta$par[2]), fn=fobj_Bibeta)
  
  fobj_Bigamma<-function(pars){
    fi<-function(x){(FuncBigamma(x, pars[1], pars[2], pars[3], pars[4])-piecewise(x))^2}
    integrate(fi,0,1)[[1]]}
  optres_Bigamma<-optim(par=c(1,1,1,1), fn=fobj_Bigamma, lower=c(0,0,0,0), method="L-BFGS-B")
  
  fobj_Power<-function(pars){
    fi<-function(x){(FuncPower(x, pars[1])-piecewise(x))^2}
    integrate(fi,0,1)[[1]]}
  optres_Power<-optim(par=c(.5), fn=fobj_Power, lower=c(0), upper=c(1), method="Brent")
  
  names<-c(names, input_name)
  Binormal_1<-c(Binormal_1, optres_Binormal$par[1])
  Binormal_2<-c(Binormal_2, optres_Binormal$par[2])
  Binormal_obj<-c(Binormal_obj, optres_Binormal$value)
  Binormal_rmsp<-c(Binormal_rmsp, sqrt(optres_Binormal$value)*100)
  Midnormal_1<-c(Midnormal_1, optres_Midnormal$par[1])
  Midnormal_obj<-c(Midnormal_obj, optres_Midnormal$value)
  Midnormal_rmsp<-c(Midnormal_rmsp, sqrt(optres_Midnormal$value)*100)
  Bifractal_1<-c(Bifractal_1, optres_Bifractal$par[1])
  Bifractal_2<-c(Bifractal_2, optres_Bifractal$par[2])
  Bifractal_obj<-c(Bifractal_obj, optres_Bifractal$value)
  Bifractal_rmsp<-c(Bifractal_rmsp, sqrt(optres_Bifractal$value)*100)
  Midfractal_1<-c(Midfractal_1, optres_Midfractal$par[1])
  Midfractal_obj<-c(Midfractal_obj, optres_Midfractal$value)
  Midfractal_rmsp<-c(Midfractal_rmsp, sqrt(optres_Midfractal$value)*100)
  Bilogistic_1<-c(Bilogistic_1, optres_Bilogistic$par[1])
  Bilogistic_2<-c(Bilogistic_2, optres_Bilogistic$par[2])
  Bilogistic_obj<-c(Bilogistic_obj, optres_Bilogistic$value)
  Bilogistic_rmsp<-c(Bilogistic_rmsp, sqrt(optres_Bilogistic$value)*100)
  Bibeta_1<-c(Bibeta_1, optres_Bibeta$par[1])
  Bibeta_2<-c(Bibeta_2, optres_Bibeta$par[2])
  Bibeta_3<-c(Bibeta_3, optres_Bibeta$par[3])
  Bibeta_4<-c(Bibeta_4, optres_Bibeta$par[4])
  Bibeta_obj<-c(Bibeta_obj, optres_Bibeta$value)
  Bibeta_rmsp<-c(Bibeta_rmsp, sqrt(optres_Bibeta$value)*100)
  SBibeta_1<-c(SBibeta_1, optres_SBibeta$par[1])
  SBibeta_2<-c(SBibeta_2, optres_SBibeta$par[2])
  SBibeta_obj<-c(SBibeta_obj, optres_SBibeta$value)
  SBibeta_rmsp<-c(SBibeta_rmsp, sqrt(optres_SBibeta$value)*100)
  Bigamma_1<-c(Bigamma_1, optres_Bigamma$par[1])
  Bigamma_2<-c(Bigamma_2, optres_Bigamma$par[2])
  Bigamma_3<-c(Bigamma_3, optres_Bigamma$par[3])
  Bigamma_4<-c(Bigamma_4, optres_Bigamma$par[4])
  Bigamma_obj<-c(Bigamma_obj, optres_Bigamma$value)
  Bigamma_rmsp<-c(Bigamma_rmsp, sqrt(optres_Bigamma$value)*100)
  Power_1<-c(Power_1, optres_Power$par[1])
  Power_obj<-c(Power_obj, optres_Power$value)
  Power_rmsp<-c(Power_rmsp, sqrt(optres_Power$value)*100)
})

ROC_fitting(BergC_x, BergC_y, "Berg2020C")
ROC_fitting(BergF_x, BergF_y, "Berg2020F")
ROC_fitting(Conolly_I_x, Conolly_I_y, "Conolly2015I")
ROC_fitting(Conolly_II_x, Conolly_II_y, "Conolly2015I")
ROC_fitting(Jennings_x, Jennings_y, "Jennings2017")
ROC_fitting(HahmA_x, HahmA_y, "Hahm2011A")
ROC_fitting(HahmB_x, HahmB_y, "Hahm2011B")
ROC_fitting(Iyer_x, Iyer_y, "Iyer2016")
ROC_fitting(Rezac_x, Rezac_y, "Rezac2011")
ROC_fitting(RezacB_x, RezacB_y, "Rezac2011B")
ROC_fitting(Tobback_x, Tobback_y, "Tobback2019")
ROC_fitting(Wojcicki_x, Wojcicki_y, "Wojcicki2010")
ROC_fitting(A1_x, A1_y, "A1")
ROC_fitting(A2_x, A2_y, "A2")
ROC_fitting(B1_x, B1_y, "B1")
ROC_fitting(B2_x, B2_y, "B2")
ROC_fitting(B3_x, B3_y, "B3")
ROC_fitting(C1_x, C1_y, "C1")
ROC_fitting(D1_x, D1_y, "D1")


results<-data.frame(names, 
                    Binormal_rmsp,
                    Midnormal_rmsp,
                    Bifractal_rmsp,
                    Midfractal_rmsp,
                    Bilogistic_rmsp,
                    Bibeta_rmsp,
                    SBibeta_rmsp,
                    Bigamma_rmsp,
                    Power_rmsp)
#View(results)

resultsfull<-data.frame(names, 
                        Binormal_1,
                        Binormal_2,
                        Binormal_obj,
                        Binormal_rmsp,
                        Midnormal_1,
                        Midnormal_obj,
                        Midnormal_rmsp,
                        Bifractal_1,
                        Bifractal_2,
                        Bifractal_obj,
                        Bifractal_rmsp,
                        Midfractal_1,
                        Midfractal_obj,
                        Midfractal_rmsp,
                        Bilogistic_1,
                        Bilogistic_2,
                        Bilogistic_obj,
                        Bilogistic_rmsp,
                        Bibeta_1,
                        Bibeta_2,
                        Bibeta_3,
                        Bibeta_4,
                        Bibeta_obj,
                        Bibeta_rmsp,
                        SBibeta_1,
                        SBibeta_2,
                        SBibeta_obj,
                        SBibeta_rmsp,
                        Bigamma_1,
                        Bigamma_2,
                        Bigamma_3,
                        Bigamma_4,
                        Bigamma_obj,
                        Bigamma_rmsp,
                        Power_1,
                        Power_obj,
                        Power_rmsp)

View(resultsfull)

results2<-colMeans(results[,2:10])
View(data.frame(results2))

minima<-apply(results[,2:10], 1, FUN = min)==results[,2:10]
colSums(minima)

maxima<-apply(results[,2:10], 1, FUN = max)==results[,2:10]
colSums(maxima)

sum(results$Bifractal_rmsp<results$Binormal_rmsp)

results_rounded<-results
for (i in 2:dim(results)[2]){
  results_rounded[,i]=round(results[,i],2)
}
View(results_rounded)

# Figure 1
# bifractal plot

if(save_figures_flag) {win.metafile("fig_1_bifractal_curves.wmf", width = 5, height = 5)}
save_par<-par(mar=c(2,2,1,1))


curve(FuncBifractal(x,.5,.5),lwd=2, main='', xlab='', ylab='')
curve(FuncBifractal(x,.7,.5),add=TRUE, lty=2, lwd=2)
curve(FuncBifractal(x,1,.5),add=TRUE, lty=3, lwd=2)
curve(FuncBifractal(x,0,.5),add=TRUE, lty=4, lwd=2)

legend( x="bottomright", 
        legend=c(expression(paste("Bifractal curve with ", beta, " = .5 and ", gamma, " = .5"))
                 , expression(paste("Bifractal curve with ", beta, " = .7 and ", gamma, " = .5"))
                 , expression(paste("Bifractal curve with ", beta, " = 1 and ", gamma, " = .5"))
                 , expression(paste("Bifractal curve with ", beta, " = 0 and ", gamma, " = .5"))
                 
        ),
        lty=c(1,2,3,4),
        lwd=c(1,2,2,2),
        pch=c(NA,NA,NA,NA) )

par(save_par)
if(save_figures_flag) {dev.off()}


#Figure 2 
# binormal plot
if(save_figures_flag) {win.metafile("fig_2_binormal_curves.wmf", width = 5, height = 5)}
save_par<-par(mar=c(2,2,1,1))
curve(FuncBinormal(x,1,.5),lwd=2, main='', xlab='', ylab='')
curve(FuncBinormal(x,1.5,.5),add=TRUE, lty=2, lwd=2)
curve(FuncBinormal(x,2,.5),add=TRUE, lty=3, lwd=2)
curve(FuncBinormal(x,.7,.5),add=TRUE, lty=4, lwd=2)

legend( x="bottomright", 
        legend=c(expression(paste("Binormal curve with b = 1 and ", gamma, " = .5"))
                 , expression(paste("Binormal curve with b = 1.5 and ", gamma, " = .5"))
                 , expression(paste("Binormal curve with b = 2.0 and ", gamma, " = .5"))
                 , expression(paste("Binormal curve with b = .7 and ", gamma, " = .5"))
                 
        ),
        lty=c(1,2,3,4),
        lwd=c(1,2,2,2),
        pch=c(NA,NA,NA,NA) )
par(save_par)
if(save_figures_flag) {dev.off()}



#Figure 3
if(save_figures_flag) {win.metafile("fig_3_rrfit.wmf", width = 5, height = 5)}
save_par<-par(mar=c(2,2,1,1))

plot(Rezac_x,Rezac_y, main='', xlab='', ylab='', lwd=3)

curve(FuncBinormal(x,resultsfull$Binormal_1[which(resultsfull$names=='Rezac2011')],
                   resultsfull$Binormal_2[which(resultsfull$names=='Rezac2011')]),add=TRUE, lwd=1)

curve(FuncBifractal(x,resultsfull$Bifractal_1[which(resultsfull$names=='Rezac2011')]
                    , resultsfull$Bifractal_2[which(resultsfull$names=='Rezac2011')]),add=TRUE, lty=2, lwd=2)

curve(FuncBilogistic(x,resultsfull$Bilogistic_1[which(resultsfull$names=='Rezac2011')]
                     , resultsfull$Bilogistic_2[which(resultsfull$names=='Rezac2011')]),add=TRUE, lty=3, lwd=2)

curve(FuncPower(x,resultsfull$Power_1[which(resultsfull$names=='Rezac2011')]),add=TRUE, lty=4, lwd=2)

legend( x="bottomright", 
        legend=c("Actual ROC curve points"
                 , "Fitted binormal ROC curve"
                 , "Fitted bifractal ROC curve"
                 , "Fitted bilogistic ROC curve"
                 , "Fitted power ROC curve"
        ),
        lty=c(0,1,2,3,4),
        lwd=c(3,1,2,2,2),
        pch=c(1,NA,NA,NA,NA) )
par(save_par)
if(save_figures_flag) {dev.off()}

paste0('Binormal: b=', resultsfull$Binormal_1[which(resultsfull$names=='Rezac2011')], ' gamma=', resultsfull$Binormal_2[which(resultsfull$names=='Rezac2011')], ' fobj=', resultsfull$Binormal_obj[which(resultsfull$names=='Rezac2011')])
paste0('Bifractal: beta=', resultsfull$Bifractal_1[which(resultsfull$names=='Rezac2011')], ' gamma=', resultsfull$Bifractal_2[which(resultsfull$names=='Rezac2011')], ' fobj=', resultsfull$Bifractal_obj[which(resultsfull$names=='Rezac2011')])
paste0('Bilogistic: alpha0=', resultsfull$Bilogistic_1[which(resultsfull$names=='Rezac2011')], ' alpha1=', resultsfull$Bilogistic_2[which(resultsfull$names=='Rezac2011')], ' fobj=', resultsfull$Bilogistic_obj[which(resultsfull$names=='Rezac2011')])
paste0('Power: gamma=', resultsfull$Power_1[which(resultsfull$names=='Rezac2011')], ' fobj=', resultsfull$Power_obj[which(resultsfull$names=='Rezac2011')])
paste0('Power: theta=', (1-resultsfull$Power_1[which(resultsfull$names=='Rezac2011')])/(1+resultsfull$Power_1[which(resultsfull$names=='Rezac2011')]), ' fobj=', resultsfull$Power_obj[which(resultsfull$names=='Rezac2011')])


# Gini based on Rezac & Rezac data
ginic<-function(bc, gc){
  #function for gini when we have cumulative goods and bads vectors
  sum((gc[2:(length(gc))]-gc[1:(length(gc)-1)])*
        (bc[2:(length(bc))]+bc[1:(length(bc)-1)]))-1
} 

ginic(Rezac_y, Rezac_x)
ginic(RezacB_y, RezacB_x)


# Figure 4
res_all<-results2
model<-c('binormal', 'midnormal', 'bifractal', 'midfractal', 'bilogistic', 'bibeta', 'simple bibeta', 
         'bigamma', 'power')
n_parameters<-factor(c(2, 1, 2, 1, 2, 4, 2, 4, 1), 
                     labels = c('1 parameter', '2 parameters', '4 parameters'))
explicit_gini<-factor(1-c(1,1,1,1,0,0,0,0,1), 
                      labels = c('explicit Gini', 'no explicit Gini'))
res_summary<-data.frame(model, res_all, n_parameters, explicit_gini)
res_summary$model<-factor(res_summary$model, levels=res_summary$model[order(res_summary$res_all)])


if(save_figures_flag) {win.metafile("fig_4_compar.wmf", width = 6.5, height = 5)}
save_par<-par(mar=c(2,2,1,1))

ggplot(data=res_summary, aes(x=model, y=res_all, lty=explicit_gini, fill=n_parameters)) +
  geom_bar(colour="black", size=1, position="dodge", stat="identity") +
  geom_text(aes(label = sprintf("%.2f", res_all), y= res_all, col=NULL),  hjust = 1.5) +
  coord_flip()+
  theme_bw()+
  scale_fill_brewer(name = "number of parameters", palette=6)+
  scale_linetype_discrete(name = "parameter intepretation")+
  scale_y_discrete(name="average fit")+
  xlab('')

par(save_par)
if(save_figures_flag) {dev.off()}

# Properness check
mean(resultsfull$Binormal_1)
sd(resultsfull$Binormal_1)
max(resultsfull$Binormal_1)
min(resultsfull$Binormal_1)

#Properness check: 

f1 <- function(x){FuncBinormal(x,max(resultsfull$Binormal_1),.74)}
f1<- Vectorize(f1)
points<-10^-(1:60)
max(points[points>f1(points)])

curve(f1, 0, max(points[points>f1(points)])*50)
abline(a=0, b=1)

binoplot<-function(x, y, name){
  if(save_figures_flag) {win.metafile(name, width = 5, height = 5)}
  save_par<-par(mar=c(4.2,4,1,1))
  lmqq<-function(x,y){lm(qnorm(y[!(x==0|x==1|y==0|y==1)])
                         ~qnorm(x)[!(x==0|x==1|y==0|y==1)])}
  myticks<-c(0.001, 0.01, c(1,3,5,7,9)/10, .99, .999)
  plot(qnorm(x), qnorm(y), axes=FALSE, xlab="Cumulative good proportion", ylab="Cumulative bad proportion",   
       xlim=c(qnorm(0.001),qnorm(0.999)), ylim=c(qnorm(0.001),qnorm(0.999)))
  axis(side=1, at=qnorm(myticks), labels=myticks)
  axis(side=2, at=qnorm(myticks), labels=myticks)
  axis(side=3)
  axis(side=4)
  box()
  abline(0,1, lty=2)
  abline(lmqq(x,y))
  par(save_par)
  if(save_figures_flag) {dev.off()}
}


binoplot(A1_x, A1_y, "fig_5a_a1binormal.wmf")
binoplot(RezacB_x, RezacB_y, "fig_5b_RRbinormal.wmf")
binoplot(Tobback_x, Tobback_y, "fig_5c_Tobbackbinormal.wmf")
binoplot(C1_x, C1_y, "fig_5d_C1binormal.wmf")

